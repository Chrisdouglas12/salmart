<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home | Salmart</title>
    <link rel="manifest" href="/manifest.json" />
<meta name="theme-color" content="#ffffff">
<meta name="msapplication-navbutton-color" content="#ffffff">
<meta name="nav-color" content="#ffffff">
<meta name="color-scheme" content="light">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link rel="apple-touch-icon" href="/salmart-192x192.png" />
    <link rel="stylesheet" href="Style.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Serif+Display:ital@0;1&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <style>
        /* Skeleton Loader */
        .skeleton-post {
            background: white;
     
            margin: 10px;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            
        }

        .skeleton-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .skeleton-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            margin-right: 10px;
        }

        .skeleton-user-info {
            flex: 1;
        }

        .skeleton-line {
            height: 12px;
            border-radius: 4px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            margin-bottom: 8px;
        }

        .skeleton-line.short {
            width: 60%;
        }

        .skeleton-line.very-short {
            width: 30%;
        }

        .skeleton-image {
            width: 100%;
            height: 200px;
            border-radius: 10px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            margin: 10px 0;
        }
           .skeleton-button {
            width: 40%;
            height: 40px;
            border-radius: 5px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            margin: 10px auto;
        }

        .skeleton-actions {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        @keyframes skeleton-loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }

        /* Toast (override inline styles for smoother animation) */
        #toast {
            min-width: 200px;
            color: white;
            text-align: center;
            border-radius: 8px;
            padding: 12px 16px;
            position: fixed;
            z-index: 1000;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-family: Poppins, sans-serif;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.5s ease, bottom 0.5s ease;
        }

        #toast.show {
            opacity: 1;
            bottom: 50px;
        }


        /* Professional Install Button Solution */
        .install-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50; /* Reduced z-index to stay below header */
            padding: 16px 24px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 50px;
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
            font-family: inherit;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: none;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            user-select: none;
            -webkit-user-select: none;
            /* Ensure it doesn't interfere with scrolling */
            pointer-events: auto;
        }

        .install-btn::before {
            content: "ðŸ“±";
            font-size: 16px;
        }

        .install-btn:hover {
            background: linear-gradient(135deg, #1e7e34 0%, #17a2b8 100%);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 12px 35px rgba(40, 167, 69, 0.4);
        }

        .install-btn:active {
            transform: translateY(0) scale(1.02);
        }

        /* Slide up animation for bottom positioning */
        .install-btn.show {
            display: flex !important;
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
                scale: 0.8;
            }
            to {
                transform: translateY(0);
                opacity: 1;
                scale: 1;
            }
        }

        /* Auto-hide functionality */
        .install-btn.auto-hide {
            animation: autoHide 0.3s ease-out 5s forwards;
        }

        @keyframes autoHide {
            to {
                opacity: 0.7;
                transform: scale(0.9);
            }
        }

        .install-btn.auto-hide:hover {
            opacity: 1;
            transform: scale(1.05) translateY(-2px);
        }

        /* Alternative: Compact floating button */
        .install-btn.compact {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            padding: 0;
            font-size: 24px;
            justify-content: center;
        }

        .install-btn.compact::before {
            margin: 0;
        }

        .install-btn.compact .btn-text {
            display: none;
        }



        /* Responsive Design */
        @media (max-width: 768px) {


            .install-btn {
                right: 15px;
                bottom: 90px; /* Above bottom navigation */
                padding: 12px 20px;
                font-size: 13px;
            }

            .install-btn.compact {
                width: 50px;
                height: 50px;
                bottom: 90px;
            }


        @media (max-width: 480px) {
            .install-btn {
                right: 10px;
                bottom: 85px;
                padding: 10px 16px;
                font-size: 12px;
            }

            /* Option: Show as banner at top instead on very small screens */
            .install-btn.banner-mode {
                position: fixed;
                top: 70px;
                left: 10px;
                right: 10px;
                bottom: auto;
                border-radius: 12px;
                z-index: 40;
                margin: 0;
                width: calc(100% - 20px);
            }
        }

        /* Hide button when PWA is installed */
        .install-btn.installed {
            opacity: 0;
            pointer-events: none;
            transform: scale(0);
        }

    </style>

    <script src="addPic.js"></script>


</head>
<body>
     
  <div class="Genenral-container">
    <div class="menu-icon">
      <div></div>
      <div></div>
      <div></div>
    </div>
    <div class="profile-pic">
      <img id="profile-picture3" width="40px" height="40px" src="default-avater.png" style="border-radius: 50%">
    </div>
    <div style="text-align:center">
      <div style="z-index: 3; position: fixed; margin-left: 83.5%; margin-top: 16px; font-size: 16px;">
        <a href="Search.html">
          <i class="fas fa-search" style="color:#28a745; border: 0.1px solid #fff; border-radius: 20px; padding: 8.5px; background-color:#fff; box-shadow: 0 0 10px #ddd; font-weight: light; margin-left: auto"></i>
        </a>
      </div>
<h2 class="head" style="
  color: #28a745;
  background-color: white;
  padding: 20px 0;
  margin: 0;
  box-shadow: 0 0px 10px 0px #ddd;
  border: 1px solid #fff;
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1;
  text-align: center;
  font-size: 19px;
  font-family: 'Poppins', sans-serif;
  width: 100vw;
">
  Salmart
</h2>
    </div>

<button id="installBtn" class="install-btn"> Install Salmart</button>



    <script>
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');
        let hideTimer;

        // Enhanced PWA install logic
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // Show the install button with professional animation
            installBtn.classList.add('show');
            
            // Auto-hide after 5 seconds for better UX
            setTimeout(() => {
                installBtn.classList.add('auto-hide');
            }, 5000);

            installBtn.addEventListener('click', async () => {
                installBtn.disabled = true;
                installBtn.style.opacity = '0.6';
                
                try {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                        installBtn.classList.add('installed');
                    } else {
                        console.log('User dismissed the install prompt');
                        installBtn.disabled = false;
                        installBtn.style.opacity = '1';
                    }
                } catch (error) {
                    console.error('Install prompt failed:', error);
                    installBtn.disabled = false;
                    installBtn.style.opacity = '1';
                }

                deferredPrompt = null;
            });
        });

        // Hide button when app is installed
        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed');
            installBtn.classList.add('installed');
        });


        // Responsive button mode switching
        function updateButtonMode() {
            const isMobile = window.innerWidth <= 480;
            const isTablet = window.innerWidth <= 768;
            
            if (isMobile) {
                // On very small screens, optionally switch to banner mode
                // installBtn.classList.add('banner-mode');
            } else {
                installBtn.classList.remove('banner-mode');
            }
        }

        window.addEventListener('resize', updateButtonMode);
        updateButtonMode();

        // Demo: Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
            });
        });
    </script>
    <div style="text-align: center">
      <div id="delete-modal" class="modern-modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Confirm Deletion</h3>
            <button class="close-modal">Ã—</button>
          </div>
          <div class="modal-body">
            <div class="modal-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#e74c3c">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
              </svg>
            </div>
            <p>Are you sure you want to delete this Ad?</p>
            <p class="secondary-text">This action cannot be undone and the Ad will be permanently removed.</p>
          </div>
          <div class="modal-footer">
            <button id="cancel-delete" class="secondary-button">Cancel</button>
            <button id="confirm-delete" class="danger-button">
              <span class="button-loader" id="delete-loader"></span>
              <span class="button-text">Delete</span>
            </button>
          </div>
        </div>
      </div>

<nav id="navbar">
  <ul>
    <li>
      <a href="index.html" class="active">
        <i class="fas fa-store"></i>
        <span>Market</span>
      </a>
    </li>
    <li>
      <a href="requestlists.html">
        <i class="fas fa-clipboard-list"></i>
        <span>Requests</span>
      </a>
    </li>
    <li>
      <a href="Alerts.html" onclick="clearBadge('alerts')">
        <span class="icon-with-badge">
          <i class="fas fa-bell"></i>
          <span class="notification-badge" id="alerts-badge"></span>
        </span>
        <span>Alerts</span>
      </a>
    </li>
    <li>
      <a href="Messages.html" onclick="clearBadge('messages')">
        <span class="icon-with-badge">
          <i class="fas fa-comments"></i>
          <span class="notification-badge" id="messages-badge"></span>
        </span>
        <span>Messages</span>
      </a>
    </li>
    <li>
      <a href="Deals.html" onclick="clearBadge('deals')">
        <span class="icon-with-badge">
          <i class="fas fa-cart-plus"></i>
          <span class="notification-badge" id="deals-badge"></span>
        </span>
        <span>Deals</span>
      </a>
    </li>
    <li>
      <a href="Profile.html">
        <i class="fas fa-user"></i>
        <span>Profile</span>
      </a>
    </li>
  </ul>
</nav>
      <div id="toast" style="display:none;"></div>
    </div>
    <div class="side-bar">
      <div class="profile-sec">
        <img src="default-avater.png" alt="pic" id="profile-picture1">
        <h1 id="username1">Username</h1>
      </div>
      <ul>
        <li><a href="index.html" class="active"><i class="fas fa-store"></i>Market</a></li>
        <li><a href="Alerts.html"><i class="fas fa-bell"></i> Alerts</a></li>
        <li><a href="Messages.html"><i class="fas fa-comment"></i>Messages</a></li> 
        <li><a href="Deals.html"><i class="fas fa-cart-plus"></i>Deals</a></li>
        <li><a href="Profile.html"><i class="fas fa-user"></i> Profile</a></li>
        <li><a href="Profile.html"><i class="fa-solid fa-lock"></i> Privacy Policy</a></li>
        <li><a href="Privacy.html"><i class="fa-solid fa-circle-info"></i> Community Standards</a></li>
        <li><a href="SignIn.html" id="logout-link"><i class="fas fa-sign-out-alt"></i> <span id="logout-text">Log out</span></a></li>
      </ul>
      <pre style="font-size: 10px; text-align: center; margin-top: 40px; color: green">Â©Salmart Technologies 2025</pre>
    </div>
    
           <div class="create-post-container">
      <div>
        <a href="Ads.html"><button  class="post-input" style="background-color: #fff; color: #28a745; font-family: 'Poppins'; border: solid: 1px #fff; box-shadow: 0 0 10px #ddd; font-size: 12px; font-weight: 500; max-width: 250px;"><i class="fas fa-bullhorn"></i> Create an ad</button></a>
        <a href="Request.html"><button class="post-input" style="background-color: #fff; color: #28a745; font-family: 'Poppins'; border: solid: 1px #fff; box-shadow: 0 0 10px #ddd; font-size: 12px;font-weight: 500;max-width: 250px;">Create a request <i class="fas fa-circle-plus"></i></button></a>
      </div>

      <div class="category-filter" ">
        <div class="category-scroll-wrapper">
          <div class="category-scroll">
            <button class="category-btn active" data-category="all"><i class="fas fa-layer-group"></i> All</button>
            <button class="category-btn" data-category="electronics"><i class="fas fa-tv"></i> Electronics</button>
            <button class="category-btn" data-category="fashion"><i class="fas fa-tshirt"></i> Fashion</button>
            <button class="category-btn" data-category="home"><i class="fas fa-tree"></i> Home & Garden</button>
            <button class="category-btn" data-category="vehicles"><i class="fas fa-car"></i> Vehicles</button>
            <button class="category-btn" data-category="music"><i class="fas fa-guitar"></i> Music Gear</button>
            <button class="category-btn" data-category="others"><i class="fas fa-box-open"></i> Other</button>
          </div>
        </div>
      </div> 
    </div>

   
     <div class="main-layout">
  <!-- Left Sidebar: Login -->
  <div class="sidebar left">
    <iframe src="Search.html" frameborder="0"></iframe>
  </div>

  <!-- Center Feed -->
  <div class="feed" id="posts-container">
    <div class="skeleton-post">
      <div class="skeleton-header">
        <div class="skeleton-avatar"></div>
        <div class="skeleton-user-info">
          <div class="skeleton-line short"></div>
          <div class="skeleton-line very-short"></div>
        </div>
      </div>
      <div class="skeleton-line"></div>
      <div class="skeleton-line short"></div>
      <div class="skeleton-line short"></div>
      <div class="skeleton-line short"></div>
      <div class="skeleton-image"></div>
      <div class="skeleton-button"></div>
      <div class="skeleton-actions">
        <div class="skeleton-line very-short"></div>
        <div class="skeleton-line very-short"></div>
      </div>
    </div>

    <div class="skeleton-post">
      <div class="skeleton-header">
        <div class="skeleton-avatar"></div>
        <div class="skeleton-user-info">
          <div class="skeleton-line short"></div>
          <div class="skeleton-line very-short"></div>
        </div>
      </div>
      <div class="skeleton-line"></div>
      <div class="skeleton-line short"></div>
      <div class="skeleton-line short"></div>
      <div class="skeleton-line short"></div>
      <div class="skeleton-image"></div>
      <div class="skeleton-button"></div>
      <div class="skeleton-actions">
        <div class="skeleton-line very-short"></div>
        <div class="skeleton-line very-short"></div>
      </div>
    </div>

    <div class="skeleton-post">
      <div class="skeleton-header">
        <div class="skeleton-avatar"></div>
        <div class="skeleton-user-info">
          <div class="skeleton-line short"></div>
          <div class="skeleton-line very-short"></div>
        </div>
      </div>
      <div class="skeleton-line"></div>
      <div class="skeleton-line short"></div>
      <div class="skeleton-line short"></div>
      <div class="skeleton-line short"></div>
      <div class="skeleton-image"></div>
      <div class="skeleton-button"></div>
      <div class="skeleton-actions">
        <div class="skeleton-line very-short"></div>
        <div class="skeleton-line very-short"></div>
      </div>
    </div>
  </div>

  <!-- Right Sidebar: Community -->
  <div class="sidebar right">
    <iframe src="Messages.html" frameborder="0"></iframe>
  </div>
</div>

    <div id="imageModal" class="modal">
      <span class="close">Ã—</span>
      <img class="modal-content" id="fullImage">
    </div>
    <div id="image-preview-container" style="display: flex; gap: 5px; margin-top: 10px;"></div>
    <div id="galleryModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center;">
      <div id="galleryContent" style="display: flex; flex-wrap: wrap; gap: 10px; max-width: 90%; max-height: 90%; overflow-y: auto;"></div>
    </div>

    
    <script>
    const menuIcon = document.querySelector('.menu-icon');
    const sideBar = document.querySelector('.side-bar');
    const body = document.body;
    menuIcon.addEventListener('click', () => {
      sideBar.style.display = sideBar.style.display === 'block' ? 'none' : 'block';
      body.classList.toggle('no-scroll');
    });
    document.body.addEventListener('click', (e) => {
      if (sideBar.style.display === 'block' && !sideBar.contains(e.target) && !menuIcon.contains(e.target)) {
        sideBar.style.display = 'none';
        body.classList.remove('no-scroll');
      }
    });
    </script>
    <script>
    window.onload = function() {
      const isLoggedIn = localStorage.getItem('userId');
      const logoutText = document.getElementById('logout-text');
      const logoutLink = document.getElementById('logout-link');
      if (isLoggedIn) {
        logoutText.innerText = 'Log out';
        logoutLink.href = '#';
        logoutLink.addEventListener('click', function(event) {
          event.preventDefault();
          localStorage.removeItem('userId');
          window.location.href = 'SignIn.html';
        });
      } else {
        logoutText.innerText = 'Log in';
        logoutLink.href = 'SignIn.html';
      }
    };
    </script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
    const API_BASE_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000' : 'https://salmart.onrender.com';
    const socket = io(`${API_BASE_URL}`, {
      path: '/socket.io',
      transports: ['websocket', 'polling']
    });
    socket.on('connect', () => {
      console.log('Connected to server');
    });
    </script>

    <script>
    function openImage(imageUrl) {
      const modal = document.getElementById("imageModal");
      const fullImage = document.getElementById("fullImage");
      fullImage.src = imageUrl;
      modal.style.display = "flex";
      modal.onclick = function (event) {
        if (event.target === modal || event.target.classList.contains("close")) {
          modal.style.display = "none";
        }
      };
    }
    </script>
    <script>
    function showToast(message, color = '#28a745') {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.style.backgroundColor = color;
      toast.style.display = "block";
      setTimeout(() => {
        toast.style.display = "none";
      }, 3000);
    }
    </script>
    <script>
    let currentCategory = 'all';
    // Removed allPostsCache as it's handled in posts.js now.
    document.addEventListener('DOMContentLoaded', function() {
      const categoryBtns = document.querySelectorAll('.category-btn');
      categoryBtns.forEach(btn => {
        btn.addEventListener('click', async function() {
          categoryBtns.forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          currentCategory = this.dataset.category;
          // *** THE CRITICAL CHANGE HERE: ***
          // Call window.fetchPosts, which is the function exposed globally by posts.js
          // and accepts category, page, and clearExisting as arguments.
          // We want to clear existing posts when a new category is selected.
          if (window.fetchPosts) { // Ensure the function is loaded
            await window.fetchPosts(currentCategory, 1, true); // Pass category, reset page to 1, clear existing
          } else {
            console.error("window.fetchPosts is not defined. Ensure posts.js is loaded correctly.");
          }
        });
      });
    });
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      const categoryFilter = document.querySelector('.category-filter');
      const header = document.querySelector('.head');
      const headerHeight = header.offsetHeight;
      const stickyPosition = 60;
      const spacer = document.createElement('div');
      spacer.style.height = categoryFilter.offsetHeight + 'px';
      spacer.style.display = 'none';
      categoryFilter.parentNode.insertBefore(spacer, categoryFilter.nextSibling);
      const initialTop = categoryFilter.getBoundingClientRect().top + window.scrollY;
      window.addEventListener('scroll', function() {
        const scrollY = window.scrollY || window.pageYOffset;
        if (scrollY >= initialTop - stickyPosition) {
          categoryFilter.style.position = 'fixed';
          categoryFilter.style.top = stickyPosition + 'px';
          categoryFilter.style.left = '0';
          categoryFilter.style.right = '0';
          categoryFilter.style.zIndex = '100';
          spacer.style.display = 'block';
        } else {
          categoryFilter.style.position = 'static';
          spacer.style.display = 'none';
        }
      });
      window.dispatchEvent(new Event('scroll'));
    });
    
    
    </script>
    <script src="Badge.js"></script>

  
    <script type="module" src="firebase-app.js"></script>
 <script src="auth.js"></script>
 <script src="/idb-keyval-iife.js"></script>
  <script src="main-video-controls.js"></script>
<script type="module" src="posts.js"></script>
  <script src="posts-interaction.js"></script>
<script src="posts-sharing.js"></script>

  
  </div>
</body>
</html>
